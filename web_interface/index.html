<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Robot Control</title>
    <script src="roslib.min.js"></script>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: 10px;
        }

        .gauge {
            position: relative;
            height: 100px;
            width: 200px;
            overflow: hidden;
            background-color: #fff;
            color: #5664F9;
        }

        div.gauge {
            display: block;
        }

        span.gauge {
            display: inline-block;
        }

        .gauge .outer,
        .gauge .inner,
        .gauge .cover,
        .gauge .value {
            display: block;
        }

        .gauge .outer,
        .gauge .inner {
            border-radius: 50%;
        }

        .gauge .outer {
            position: absolute;
            background-color: #5664F9;
            width: 200px;
            height: 200px;
            padding: 0;
        }

        .gauge .inner {
            position: absolute;
            background-color: #fff;
            width: 160px;
            height: 160px;
            top: 20px;
            left: 20px;
        }

        .gauge .cover {
            position: absolute;
            width: 100%;
            height: 100%;
            bottom: 50%;
            left: 0;
            -ms-transform-origin: bottom center;
            -webkit-transform-origin: bottom center;
            transform-origin: bottom center;
            background-color: #fff;
            opacity: 0.8;
            transition: all 0.2s ease;
        }

        .gauge .value {
            font-size: 32px;
            position: absolute;
            top: -1.2em;
            left: 0;
            right: 0;
            bottom: 0;
            text-align: center;
            line-height: 1em;
            margin-top: 50%;
        }

        .gauge .lastUpdated {
            font-size: 10px;
            position: absolute;
            top: -1.2em;
            left: 0;
            right: 0;
            bottom: 0;
            text-align: center;
            margin-top: 50%;
        }

        .connectionIndicator {
            width: 20px;
            height: 20px;
            border-radius: 100%;
            margin-bottom: 5px;
        }

        .connectionIndicator:after {
            position: relative;
            left: 23px;
        }

        .connectionIndicator.connected:after {
            content: 'Connected';
        }

        .connectionIndicator.disconnected:after {
            content: 'Disconnected';
        }

        .connectionIndicator.connected {
            background: green;
        }

        .connectionIndicator.disconnected {
            background: red;
        }

        .flexbox {
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
        }

        .flexbox > div:first-child {
            margin-right: 35px;
        }
    </style>
    <script>
		function colorMix(color1, color2, ratio) {
			var hex = function (x) {
				x = x.toString(16);
				return (x.length == 1) ? '0' + x : x;
			};
			var r = Math.ceil(parseInt(color1.substring(0, 2), 16) * ratio + parseInt(color2.substring(0, 2), 16) * (1 - ratio));
			var g = Math.ceil(parseInt(color1.substring(2, 4), 16) * ratio + parseInt(color2.substring(2, 4), 16) * (1 - ratio));
			var b = Math.ceil(parseInt(color1.substring(4, 6), 16) * ratio + parseInt(color2.substring(4, 6), 16) * (1 - ratio));
			return hex(r) + hex(g) + hex(b);
		}

		function updateGuage(guage, data, percentage) {
			var browserFix = ["-ms-transform", "-webkit-transform", "transform"];
			document.getElementById(guage).getElementsByClassName("value")[0].innerText = data;
			var angle = percentage * (30 / 100);
			var color;
			var colors = ['f22e02', '2132ef', '41ea23'];
			if (angle < 15) {
				color = colorMix(colors[1], colors[0], angle / 15);
			} else {
				color = colorMix(colors[2], colors[1], (angle - 15) / 15);
			}
			angle *= 180 / 30;
			document.getElementById(guage).getElementsByClassName("outer")[0].style["background-color"] = "#" + color;
			document.getElementById(guage).getElementsByClassName("value")[0].style["color"] = "#" + color;
			browserFix.forEach(function (att) {
				document.getElementById(guage).getElementsByClassName("cover")[0].style[att] = "rotate(" + angle + "deg)";
			});
		}

		function map(x,in_min,in_max,out_min,out_max){
			return (x-in_min) * (out_max-out_min) / (in_max - in_min) + out_min;
        }

		/*socketio.on("temperature",data=>{
			updateGuage("temp-guage",(data*1.8+32).toFixed(2)+" °F",map(data,15,70,0,100))
        });

		socketio.on("battery",data=>{
			updateGuage("batt-guage",data.toFixed(2)+" V",map(data,7,9,0,100))
        });*/
        function random(min,max){
        	return Math.random()*(max-min)+min;
        }
		document.addEventListener("DOMContentLoaded",()=>{
			updateGuage("temp-guage",(40*1.8+32).toFixed(2)+" °F",map(40,15,70,0,100));
			updateGuage("batt-guage",8.15.toFixed(2)+" V",map(8.15,7,9,0,100));
			setInterval(()=>{
				var temp = random(39,41);
				updateGuage("temp-guage",(temp*1.8+32).toFixed(2)+" °F",map(temp,15,70,0,100));
				var batt = random(8,8.05);
				updateGuage("batt-guage",batt.toFixed(2)+" V",map(batt,7,9,0,100));
			},400);
        });
    </script>
</head>
<body>
<div class="flexbox">
    <div>
        <h1>Camera Stream</h1>
        <img src="http://172.20.10.13:8181/cam.mjpg" width="500px;"/>
    </div>
    <div>
        <h1>Status</h1>
        <h3>CPU Temperature</h3>
        <span class="gauge gauge-40" id="temp-guage">
                <div class="outer">
                    <div class="inner"></div>
                    <div class="cover"></div>
                    <div class="value"></div>
                </div>
        </span>
        <h3>Battery Voltage</h3>
        <span class="gauge gauge-40" id="batt-guage">
                <div class="outer">
                    <div class="inner"></div>
                    <div class="cover"></div>
                    <div class="value"></div>
                </div>
        </span>
    </div>
</div>
</body>
</html>